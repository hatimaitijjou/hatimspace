<!DOCTYPE html>
<html lang="ar" dir="rtl" id="os-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hatim OS Infinity - </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --accent: #00f2ff; --glass: rgba(15, 15, 15, 0.9);
            --border: rgba(255, 255, 255, 0.1); --shadow: 0 15px 40px rgba(0,0,0,0.6);
        }
        * { box-sizing: border-box; transition: transform 0.2s; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: white; }

        /* شاشة القفل */
        #lock-screen {
            position: fixed; inset: 0; z-index: 10000;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://w.wallhaven.cc/full/zy/wallhaven-zyxv8w.jpg') center/cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.8s cubic-bezier(0.85, 0, 0.15, 1);
        }
        #lock-clock { font-size: 90px; font-weight: 200; margin-bottom: 20px; text-shadow: 0 0 20px rgba(0,0,0,0.5); }

        /* سطح المكتب */
        #desktop {
            position: relative; height: 100vh; width: 100vw;
            background: url('https://w.wallhaven.cc/full/j3/wallhaven-j3m8p9.jpg') center/cover;
            display: none;
        }
        .icons-layer { display: grid; grid-template-columns: repeat(auto-fill, 100px); gap: 20px; padding: 40px; }
        .app-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; text-align: center; }
        .icon-shape { width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-bottom: 8px; box-shadow: var(--shadow); }

        /* النوافذ */
        .window {
            position: absolute; min-width: 400px; min-height: 300px;
            background: var(--glass); backdrop-filter: blur(25px);
            border-radius: 15px; border: 1px solid var(--border);
            display: flex; flex-direction: column; box-shadow: var(--shadow); overflow: hidden;
        }
        .win-header { padding: 12px; background: rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; cursor: move; }
        .win-body { flex: 1; overflow: auto; display: flex; flex-direction: column; }
        .close-btn { background: #ff5f56; width: 14px; height: 14px; border-radius: 50%; cursor: pointer; border: none; }

        /* تطبيق الكاميرا */
        #cam-video { width: 100%; height: 100%; background: #000; object-fit: cover; }

        /* شريط المهام */
        #taskbar {
            position: fixed; bottom: 12px; left: 50%; transform: translateX(-50%);
            background: rgba(10,10,10,0.8); backdrop-filter: blur(20px);
            padding: 8px 25px; border-radius: 40px; display: flex; gap: 20px; align-items: center; border: 1px solid var(--border); z-index: 9999;
        }
        .dock-item { font-size: 24px; color: var(--accent); cursor: pointer; }

        [dir="ltr"] .win-header { flex-direction: row-reverse; }
    </style>
</head>
<body onload="OS.init()">

    <div id="lock-screen">
        <h1 id="lock-clock">00:00</h1>
        <div style="background: var(--glass); padding: 30px; border-radius: 25px; text-align: center; border: 1px solid var(--border); width: 300px;">
            <i class="fas fa-user-astronaut" style="font-size: 50px; color: var(--accent); margin-bottom: 10px;"></i>
            <div id="lock-msg">أهلاً بك في Hatim OS</div>
            <input type="password" id="pass-field" placeholder="كلمة المرور" style="width: 100%; padding: 12px; border-radius: 12px; border: none; background: #222; color: white; text-align: center; margin: 15px 0;">
            <button onclick="OS.login()" style="width: 100%; padding: 12px; border-radius: 12px; border: none; background: var(--accent); cursor: pointer; font-weight: bold;">دخول / Login</button>
        </div>
    </div>

    <div id="desktop">
        <div class="icons-layer" id="desktop-icons"></div>
        <div id="window-manager"></div>

        <div id="taskbar">
            <i class="fas fa-shapes dock-item" onclick="OS.openApp('Store')"></i>
            <div id="task-icons" style="display:flex; gap:15px;"></div>
            <div style="width:1px; height:20px; background:var(--border)"></div>
            <div id="sys-time" style="font-size: 14px; font-weight: bold;">00:00</div>
        </div>
    </div>

    <script>
        const OS = {
            lang: 'ar', z: 100, pass: localStorage.getItem('hos_pass'),
            installed: ['Store', 'Camera', 'Browser', 'Settings'],
            appDB: {
                'Store': { ar: 'المتجر', en: 'Store', icon: 'fa-shopping-bag', bg: '#00f2ff' },
                'Camera': { ar: 'الكاميرا', en: 'Camera', icon: 'fa-camera', bg: '#ff007f' },
                'Browser': { ar: 'المتصفح', en: 'Browser', icon: 'fa-globe', bg: '#4285f4' },
                'Settings': { ar: 'الإعدادات', en: 'Settings', icon: 'fa-cog', bg: '#607d8b' },
                'Notes': { ar: 'الملاحظات', en: 'Notes', icon: 'fa-file-alt', bg: '#ff9800' }
            },

            init() {
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
                if(!this.pass) document.getElementById('lock-msg').innerText = "قم بإنشاء كلمة مرورك";
                this.renderIcons();
            },

            updateClock() {
                const t = new Date().toLocaleTimeString('en-US', {hour12: false, hour:'2-digit', minute:'2-digit'});
                document.getElementById('lock-clock').innerText = t;
                document.getElementById('sys-time').innerText = t;
            },

            login() {
                const val = document.getElementById('pass-field').value;
                if(!this.pass) {
                    if(val.length < 1) return;
                    localStorage.setItem('hos_pass', val);
                    location.reload();
                } else if(val === this.pass) {
                    document.getElementById('lock-screen').style.transform = "translateY(-100%)";
                    setTimeout(() => {
                        document.getElementById('lock-screen').style.display = "none";
                        document.getElementById('desktop').style.display = "block";
                    }, 800);
                }
            },

            renderIcons() {
                const grid = document.getElementById('desktop-icons');
                grid.innerHTML = "";
                this.installed.forEach(id => {
                    const app = this.appDB[id];
                    grid.innerHTML += `
                        <div class="app-icon" onclick="OS.openApp('${id}')">
                            <div class="icon-shape" style="background:${app.bg}"><i class="fas ${app.icon}"></i></div>
                            <span>${this.lang === 'ar' ? app.ar : app.en}</span>
                        </div>`;
                });
            },

            openApp(id) {
                if(document.getElementById('win-'+id)) return;
                const win = document.createElement('div');
                win.className = "window"; win.id = 'win-'+id;
                win.style.zIndex = ++this.z; win.style.top = "80px"; win.style.left = "100px";
                
                win.innerHTML = `
                    <div class="win-header" onmousedown="OS.drag(event, this)">
                        <button class="close-btn" onclick="OS.closeApp('${id}')"></button>
                        <span>${this.lang === 'ar' ? this.appDB[id].ar : this.appDB[id].en}</span>
                    </div>
                    <div class="win-body" id="body-${id}">${this.getUI(id)}</div>`;
                document.getElementById('window-manager').appendChild(win);
                if(id === 'Camera') this.startCamera();
            },

            getUI(id) {
                if(id === 'Camera') return `<video id="cam-video" autoplay playsinline></video>`;
                if(id === 'Browser') return `<iframe src="https://www.google.com/search?igu=1" style="width:100%; height:400px; border:none; background:white;"></iframe>`;
                if(id === 'Settings') return `<div style="padding:20px; text-align:center;">
                    <button onclick="OS.toggleLang()" style="width:100%; padding:10px; background:var(--accent); border:none; border-radius:8px; cursor:pointer; font-weight:bold; margin-bottom:10px;">Change Language / تغيير اللغة</button>
                    <button onclick="OS.reset()" style="width:100%; padding:10px; background:#ff5f56; border:none; border-radius:8px; cursor:pointer; color:white;">Format System / مسح النظام</button>
                </div>`;
                if(id === 'Store') return `<div style="padding:15px;">${Object.keys(this.appDB).map(k => `<div style="display:flex; justify-content:space-between; margin-bottom:10px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;"><span>${this.lang === 'ar' ? this.appDB[k].ar : this.appDB[k].en}</span><button onclick="OS.install('${k}')" style="background:var(--accent); border:none; border-radius:5px; cursor:pointer; padding:5px 10px;">Get</button></div>`).join('')}</div>`;
                return `<div style="padding:20px;">App Content</div>`;
            },

            startCamera() {
                const video = document.getElementById('cam-video');
                navigator.mediaDevices.getUserMedia({ video: true }).then(stream => { video.srcObject = stream; })
                .catch(err => { alert("خطأ في الكاميرا: " + err); });
            },

            install(id) {
                if(!this.installed.includes(id)) { this.installed.push(id); this.renderIcons(); alert("Success!"); }
            },

            toggleLang() {
                this.lang = this.lang === 'ar' ? 'en' : 'ar';
                document.getElementById('os-root').dir = this.lang === 'ar' ? 'rtl' : 'ltr';
                this.renderIcons();
                document.getElementById('window-manager').innerHTML = "";
            },

            closeApp(id) { 
                if(id === 'Camera') {
                    const v = document.getElementById('cam-video');
                    if(v && v.srcObject) v.srcObject.getTracks().forEach(t => t.stop());
                }
                document.getElementById('win-'+id).remove(); 
            },

            drag(e, bar) {
                const win = bar.parentElement; win.style.zIndex = ++this.z;
                let ox = e.clientX - win.offsetLeft, oy = e.clientY - win.offsetTop;
                document.onmousemove = (ev) => { win.style.left = ev.clientX - ox + "px"; win.style.top = ev.clientY - oy + "px"; };
                document.onmouseup = () => document.onmousemove = null;
            },

            reset() { if(confirm("Format?")) { localStorage.clear(); location.reload(); } }
        };
    </script>
</body>
</html>
