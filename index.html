<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iHatimOS | Notion Style</title>
    <style>
        :root { --primary: #00ff41; --bg: #0d0d0d; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #splash {
            position: fixed; inset: 0; background: black; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.8s;
        }
        .loader { width: 200px; height: 3px; background: #222; margin-top: 20px; border-radius: 10px; overflow: hidden; }
        .progress { width: 0%; height: 100%; background: var(--primary); transition: 0.3s; }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #app { opacity: 0; transition: 1s; height: 100vh; display: flex; flex-direction: column; }
        .top-nav { padding: 10px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; background: #111; }

        .editor-container { flex: 1; padding: 40px; overflow-y: auto; position: relative; display: flex; justify-content: center; }
        #editor { 
            width: 100%; max-width: 800px; outline: none; font-size: 1.2rem; 
            line-height: 1.6; color: #efefef; min-height: 500px;
        }
        #editor:empty:before { content: "Ø§ÙƒØªØ¨ / Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø£Ùˆ Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø©..."; color: #555; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù„Ø§Ø´ (Notion Style) */
        #slash-menu {
            position: absolute; background: #1a1a1a; border: 1px solid #333;
            border-radius: 8px; width: 220px; display: none; z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding: 5px;
        }
        .slash-item {
            padding: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px;
            border-radius: 5px; transition: 0.2s; font-size: 0.9rem;
        }
        .slash-item:hover { background: var(--primary); color: black; }
        .slash-item span { font-size: 1.2rem; }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        #toast {
            position: fixed; bottom: 20px; right: 20px; background: var(--primary);
            color: black; padding: 10px 20px; border-radius: 5px; display: none; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="splash">
        <h1 style="color:var(--primary); text-shadow: 0 0 15px var(--primary);">iHatimOS</h1>
        <div class="loader"><div class="progress" id="bar"></div></div>
        <p id="boot-text" style="font-family: monospace; color: #555; margin-top: 10px;">Initializing System...</p>
    </div>

    <div id="app">
        <div class="top-nav">
            <span style="color:var(--primary)">âš¡ iHatimOS v4.0</span>
            <div id="clock">00:00:00</div>
        </div>

        <div class="editor-container">
            <div id="editor" contenteditable="true"></div>
            
            <div id="slash-menu">
                <div class="slash-item" onclick="executeCommand('download')"><span>ğŸ’¾</span> ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù (Text)</div>
                <div class="slash-item" onclick="executeCommand('clear')"><span>ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø§Ù„Ù…ÙÙƒØ±Ø©</div>
                <div class="slash-item" onclick="executeCommand('time')"><span>ğŸ•’</span> Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div class="slash-item" onclick="executeCommand('rating')"><span>â­</span> ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                <div class="slash-item" onclick="executeCommand('chat')"><span>ğŸ’¬</span> Ù…Ø±Ø§Ø³Ù„Ø© Ø­Ø§ØªÙ…</div>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        const GETFORM_URL = "https://getform.io/f/bllgzwlb";
        const editor = document.getElementById('editor');
        const slashMenu = document.getElementById('slash-menu');

        // 1. Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹
        window.onload = () => {
            let p = 0;
            const interval = setInterval(() => {
                p += Math.random() * 20;
                document.getElementById('bar').style.width = p + "%";
                if(p >= 100) {
                    clearInterval(interval);
                    document.getElementById('splash').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('splash').style.display = 'none';
                        document.getElementById('app').style.opacity = '1';
                        if(localStorage.getItem('hatim_content')) editor.innerHTML = localStorage.getItem('hatim_content');
                    }, 800);
                }
            }, 150);
        };

        // 2. Ø³Ø§Ø¹Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('ar-MA');
        }, 1000);

        // 3. Ù…Ù†Ø·Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù„Ø§Ø´ (Slash Command Logic)
        editor.addEventListener('keyup', (e) => {
            const selection = window.getSelection();
            const range = selection.getRangeAt(0);
            const textBeforeCursor = range.startContainer.textContent.substring(0, range.startOffset);

            if (textBeforeCursor.endsWith('/')) {
                const rect = range.getBoundingClientRect();
                slashMenu.style.display = 'block';
                slashMenu.style.top = (rect.bottom + window.scrollY) + 'px';
                slashMenu.style.left = rect.left + 'px';
            } else {
                slashMenu.style.display = 'none';
            }
        });

        // 4. ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø±
        function executeCommand(cmd) {
            // Ù…Ø³Ø­ Ø¹Ù„Ø§Ù…Ø© / Ù…Ù† Ø§Ù„Ù†Øµ
            editor.innerHTML = editor.innerHTML.replace('/', '');
            slashMenu.style.display = 'none';

            if (cmd === 'download') {
                const blob = new Blob([editor.innerText], {type: "text/plain"});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = "HatimOS_Notes.txt";
                a.click();
                showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...");
            } 
            else if (cmd === 'clear') {
                if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡ØŸ")) editor.innerHTML = "";
            }
            else if (cmd === 'time') {
                editor.innerHTML += " [" + new Date().toLocaleTimeString() + "] ";
            }
            else if (cmd === 'rating') {
                let r = prompt("Ù‚ÙŠÙ… Ù…Ù† 5:");
                if(r) {
                    fetch(GETFORM_URL, { method: 'POST', body: JSON.stringify({t: 'Rating', v: r}) });
                    showToast("Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ!");
                }
            }
            else if (cmd === 'chat') {
                let msg = prompt("Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ù…Ø·ÙˆØ±:");
                if(msg) {
                    fetch(GETFORM_URL, { method: 'POST', body: JSON.stringify({t: 'Message', v: msg}) });
                    showToast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ!");
                }
            }
        }

        // 5. Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        editor.addEventListener('input', () => {
            localStorage.setItem('hatim_content', editor.innerHTML);
        });

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() =>
